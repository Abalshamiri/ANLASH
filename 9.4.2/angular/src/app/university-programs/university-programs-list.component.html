<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-6">
                    <h1>{{ "UniversityPrograms" | localize }}</h1>
                </div>
                <div class="col-6 text-right">
                    <button class="btn btn-primary" (click)="createProgram()">
                        <i class="fa fa-plus"></i> {{ "CreateNew" | localize }}
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid">
            <div class="card">
                <!-- Filters -->
                <div class="card-header">
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" class="form-control" [(ngModel)]="searchText" (keyup.enter)="search()"
                                placeholder="{{ 'SearchPrograms' | localize }}" />
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" [(ngModel)]="universityFilter" (change)="search()">
                                <option [ngValue]="undefined">{{ 'AllUniversities' | localize }}</option>
                                <option *ngFor="let uni of universities" [ngValue]="uni.id">
                                    {{ uni.name }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" [(ngModel)]="levelFilter" (change)="search()">
                                <option [ngValue]="undefined">{{ 'AllLevels' | localize }}</option>
                                <option *ngFor="let level of programLevels" [ngValue]="level.value">
                                    {{ level.label }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" [(ngModel)]="modeFilter" (change)="search()">
                                <option [ngValue]="undefined">{{ 'AllModes' | localize }}</option>
                                <option *ngFor="let mode of studyModes" [ngValue]="mode.value">
                                    {{ mode.label }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary btn-block" (click)="search()">
                                <i class="fa fa-search"></i> {{ 'Search' | localize }}
                            </button>
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-secondary btn-block" (click)="clearFilters()"
                                title="{{ 'ClearFilters' | localize }}">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="card-body">
                    <!-- Loading Indicator -->
                    <div *ngIf="isTableLoading" class="text-center py-5">
                        <i class="fa fa-spinner fa-spin fa-3x text-primary"></i>
                        <p class="mt-3 text-muted">{{ 'Loading' | localize }}...</p>
                    </div>

                    <div class="table-responsive" *ngIf="!isTableLoading">
                        <table class="table table-striped table-bordered">
                            <thead class="bg-light">
                                <tr>
                                    <th>{{ 'ProgramName' | localize }}</th>
                                    <th>{{ 'University' | localize }}</th>
                                    <th>{{ 'Level' | localize }}</th>
                                    <th>{{ 'StudyMode' | localize }}</th>
                                    <th>{{ 'Duration' | localize }}</th>
                                    <th>{{ 'TuitionFee' | localize }}</th>
                                    <th>{{ 'Status' | localize }}</th>
                                    <th style="width: 150px;">{{ 'Actions' | localize }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let program of programs">
                                    <td>
                                        <strong>{{ program.name }}</strong>
                                        <br />
                                        <small class="text-muted" *ngIf="program.nameAr">{{ program.nameAr }}</small>
                                        <br *ngIf="program.field" />
                                        <span *ngIf="program.field" class="badge badge-secondary">{{ program.field
                                            }}</span>
                                    </td>
                                    <td>
                                        <small>{{ program.universityName }}</small>
                                    </td>
                                    <td>
                                        <span class="badge badge-primary">{{ getLevelLabel(program.level) }}</span>
                                    </td>
                                    <td>
                                        <span class="badge badge-info">{{ getModeLabel(program.mode) }}</span>
                                    </td>
                                    <td>
                                        <small>{{ program.durationYears }} {{ 'Years' | localize }}</small>
                                        <span *ngIf="program.durationSemesters">
                                            <br /><small class="text-muted">{{ program.durationSemesters }} {{
                                                'Semesters' | localize }}</small>
                                        </span>
                                    </td>
                                    <td>
                                        <span *ngIf="program.tuitionFee">
                                            <strong>{{ program.tuitionFee | number:'1.0-0' }}</strong>
                                            <small>{{ program.currencyCode || 'SAR' }}</small>
                                            <br />
                                            <small class="text-muted">{{ program.feeType }}</small>
                                        </span>
                                        <span *ngIf="!program.tuitionFee" class="text-muted">-</span>
                                    </td>
                                    <td>
                                        <span *ngIf="program.isActive" class="badge badge-success">
                                            {{ "Active" | localize }}
                                        </span>
                                        <span *ngIf="!program.isActive" class="badge badge-secondary">
                                            {{ "Inactive" | localize }}
                                        </span>
                                        <br *ngIf="program.isFeatured" />
                                        <span *ngIf="program.isFeatured" class="badge badge-warning mt-1">
                                            <i class="fa fa-star"></i> {{ "Featured" | localize }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="btn-group" dropdown>
                                            <button class="btn btn-sm btn-primary dropdown-toggle" dropdownToggle>
                                                {{ 'Actions' | localize }} <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu" *dropdownMenu>
                                                <li>
                                                    <a class="dropdown-item" (click)="editProgram(program)">
                                                        <i class="fa fa-edit"></i> {{ 'Edit' | localize }}
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" (click)="toggleFeatured(program)">
                                                        <i class="fa fa-star"></i>
                                                        <span *ngIf="!program.isFeatured">{{ 'MarkAsFeatured' | localize
                                                            }}</span>
                                                        <span *ngIf="program.isFeatured">{{ 'UnmarkAsFeatured' |
                                                            localize }}</span>
                                                    </a>
                                                </li>
                                                <li class="divider dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger"
                                                        (click)="deleteProgram(program)">
                                                        <i class="fa fa-trash"></i> {{ 'Delete' | localize }}
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- No data message -->
                    <div class="text-center py-4" *ngIf="!isTableLoading && programs.length === 0">
                        <i class="fa fa-inbox fa-3x text-muted mb-3"></i>
                        <p class="text-muted">{{ 'NoProgramsFound' | localize }}</p>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="card-footer">
                    <div class="row">
                        <div class="col-sm-4">
                            <span class="text-muted">
                                {{ 'TotalRecordsCount' | localize: totalCount }}
                            </span>
                        </div>
                        <div class="col-sm-8 text-right">
                            <pagination [boundaryLinks]="true" [totalItems]="totalCount" [(ngModel)]="pageNumber"
                                [itemsPerPage]="pageSize" (pageChanged)="pageChanged($event)" previousText="&lsaquo;"
                                nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;">
                            </pagination>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>